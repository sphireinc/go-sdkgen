/* eslint-disable */
/**
 * AUTO-GENERATED by {{.Cfg.SDKName}} (go-sdkgen)
 * Do not edit manually.
 */

import axios, { AxiosRequestConfig, AxiosResponse } from "axios";

export type HttpMethod =
  | "GET"
  | "POST"
  | "PUT"
  | "DELETE"
  | "PATCH"
  | "HEAD"
  | "OPTIONS";

export interface RequestConfig extends AxiosRequestConfig {
  headers?: Record<string, string>;
}

export interface ApiResult<T = any> {
  success: boolean;
  data?: T;
  error?: string;
  status?: number;
}

/**
 * SDK runtime configuration
 */
let {{.Cfg.BaseURLVar}} = "";
let tokenProvider: (() => string) | null = null;

export const setBaseUrl = (baseUrl: string): void => {
  {{.Cfg.BaseURLVar}} = String(baseUrl || "").replace(/\/+$/, "");
};

export const setTokenProvider = (fn: (() => string) | null): void => {
  tokenProvider = fn;
};

const getTokenSafe = (): string => {
  if (!tokenProvider) return "";
  try {
    return tokenProvider() || "";
  } catch {
    return "";
  }
};

export const req = async <T = any>(
  method: HttpMethod,
  endpoint: string,
  data?: any,
  config: RequestConfig = {},
  headers: Record<string, string> = {}
): Promise<ApiResult<T>> => {
  const url = `${{.Cfg.BaseURLVar}}${endpoint}`;

  const cfg: RequestConfig = {
    ...config,
    method,
    headers: {
      "Content-Type": "application/json",
      ...headers,
      ...(config.headers ?? {}),
      {{- if eq .Cfg.AuthMode "bearer" }}
      ...(getTokenSafe() ? { Authorization: `Bearer ${getTokenSafe()}` } : {}),
      {{- end }}
    },
  };

  try {
    let res: AxiosResponse<T>;

    switch (method) {
      case "GET":
        res = await axios.get<T>(url, cfg);
        break;
      case "POST":
        res = await axios.post<T>(url, data, cfg);
        break;
      case "PUT":
        res = await axios.put<T>(url, data, cfg);
        break;
      case "DELETE":
        res = await axios.delete<T>(url, cfg);
        break;
      case "PATCH":
        res = await axios.patch<T>(url, data, cfg);
        break;
      case "HEAD":
        res = await axios.head<T>(url, cfg);
        break;
      case "OPTIONS":
        res = await axios.options<T>(url, cfg);
        break;
      default:
        return { success: false, error: `Unsupported method: ${method}` };
    }

    return { success: true, data: res.data, status: res.status };
  } catch (err: any) {
    let status: number | undefined = undefined;
    let message = "Unknown error";

    if (axios.isAxiosError(err)) {
      status = err.response?.status;
      // eslint-disable-next-line @typescript-eslint/no-explicit-any
      message = (err.response?.data as any)?.message || err.message || message;
    } else if (err instanceof Error) {
      message = err.message;
    }

    return { success: false, error: message, status };
  }
};