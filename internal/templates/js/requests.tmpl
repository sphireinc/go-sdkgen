/* eslint-disable */
/**
 * AUTO-GENERATED by {{.Cfg.SDKName}} (go-sdkgen)
 * Do not edit manually.
 */

import axios from "axios";
export { axios };

/**
 * SDK runtime configuration
 */
let {{.Cfg.BaseURLVar}} = "";
let tokenProvider = null;

export const setBaseUrl = (baseUrl) => {
  {{.Cfg.BaseURLVar}} = String(baseUrl || "").replace(/\/+$/, "");
};

export const setTokenProvider = (fn) => {
  tokenProvider = fn;
};

const getTokenSafe = () => {
  if (!tokenProvider) return "";
  try {
    return tokenProvider() || "";
  } catch {
    return "";
  }
};

export const req = async (
  method,
  endpoint,
  data,
  config = {},
  headers = {}
) => {
  const url = {{.Cfg.BaseURLVar}} + endpoint;

  // helpful for smoke tests / debugging
  if (config && config.__debug) {
    // eslint-disable-next-line no-console
    console.log("SDK REQ", method, url);
  }

  const cfg = {
    ...config,
    method,
    headers: {
      "Content-Type": "application/json",
      ...headers,
      ...(config.headers || {}),
      {{- if eq .Cfg.AuthMode "bearer" }}
      ...(getTokenSafe()
        ? { Authorization: `Bearer ${getTokenSafe()}` }
        : {}),
      {{- end }}
    },
  };

  try {
    let res;
    switch (method) {
      case "GET":
        res = await axios.get(url, cfg);
        break;
      case "POST":
        res = await axios.post(url, data, cfg);
        break;
      case "PUT":
        res = await axios.put(url, data, cfg);
        break;
      case "DELETE":
        res = await axios.delete(url, cfg);
        break;
      case "PATCH":
        res = await axios.patch(url, data, cfg);
        break;
      case "HEAD":
        res = await axios.head(url, cfg);
        break;
      case "OPTIONS":
        res = await axios.options(url, cfg);
        break;
      default:
        return { success: false, error: `Unsupported method: ${method}` };
    }

    return {
      success: true,
      data: res.data,
      status: res.status,
    };
  } catch (err) {
    const status = err?.response?.status;
    const message =
      err?.response?.data?.message ||
      err?.message ||
      "Unknown error";

    return {
      success: false,
      error: message,
      status,
    };
  }
};